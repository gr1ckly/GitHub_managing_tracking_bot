version: "3.9"

services:
  link_tracker:
    build:
      context: .
      dockerfile: rep_tracker/cmd/link_tracker/Dockerfile
    environment:
      SERVICE_NAME: link_tracker
      DB_DSN: postgres://rep_user:rep_pass@postgres:5432/rep_tracker?sslmode=disable
      KAFKA_BROKERS: kafka:9092
      KAFKA_TOPIC: rep_tracker_changes
      TRACK_BATCH_SIZE: "100"
      TRACK_INTERVAL_SEC: "60"
    depends_on:
      - postgres
      - kafka

  rep_tracker_server:
    build:
      context: .
      dockerfile: rep_tracker/cmd/server/Dockerfile
    environment:
      SERVICE_NAME: rep_tracker_server
      DB_DSN: postgres://rep_user:rep_pass@postgres:5432/rep_tracker?sslmode=disable
      GRPC_ADDR: 0.0.0.0:8081
      GRPC_TRANSPORT: tcp
      GRPC_ENABLE_HEALTH: "true"
      GRPC_ENABLE_REFLECTION: "true"
    ports:
      - "8081:8081"
